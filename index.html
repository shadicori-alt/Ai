<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ ุงูุฐูู - AI Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .ai-pulse { animation: pulse 2s infinite; }
        .floating-ai { position: fixed; bottom: 30px; left: 30px; z-index: 1000; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .status-badge { @apply px-3 py-1 rounded-full text-xs font-medium; }
        .status-pending { @apply bg-yellow-100 text-yellow-800; }
        .status-delivered { @apply bg-green-100 text-green-800; }
        .status-returned { @apply bg-red-100 text-red-800; }
        .priority-high { @apply bg-red-500 text-white; }
        .priority-medium { @apply bg-orange-500 text-white; }
        .priority-low { @apply bg-blue-500 text-white; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-gray-900">๐ ูุธุงู ุงูููุงุชูุฑ ุงูุฐูู</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-tachometer-alt ml-2"></i>ููุญุฉ ุงูุชุญูู
                    </a>
                    <a href="invoices.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-file-invoice ml-2"></i>ุงูููุงุชูุฑ
                    </a>
                    <a href="drivers.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-truck ml-2"></i>ุงูููุงุฏูุจ
                    </a>
                    <a href="alerts.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-bell ml-2"></i>ุงูุชูุจููุงุช
                    </a>
                    <a href="new-orders.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-plus-circle ml-2"></i>ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ
                    </a>
                    <a href="inventory.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-boxes ml-2"></i>ุงููุฎุฒูู
                    </a>
                    <a href="archive.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-archive ml-2"></i>ุงูุฃุฑุดูู
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header Section -->
        <div class="mb-8">
            <div class="gradient-bg rounded-2xl p-8 text-white card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold mb-2">ูุฑุญุจุงู ุจูู ูู ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ ุงูุฐูู</h2>
                        <p class="text-blue-100 text-lg">ุชุญูููุงุช ุฐููุฉ ูุชูุตูุงุช ูุฎุตุตุฉ ูุฏุนููุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</p>
                    </div>
                    <div class="text-6xl opacity-80">
                        <i class="fas fa-robot"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Status Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-blue-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="fas fa-file-invoice text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">ุฅุฌูุงูู ุงูููุงุชูุฑ</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalInvoices">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-green-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                        <i class="fas fa-check-circle text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">ูุณููุฉ ุงูููู</p>
                        <p class="text-2xl font-bold text-gray-900" id="todayDeliveries">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-yellow-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                        <i class="fas fa-clock text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">ููุฏ ุงูุชูุตูู</p>
                        <p class="text-2xl font-bold text-gray-900" id="pendingDeliveries">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-red-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-red-100 text-red-600">
                        <i class="fas fa-exclamation-triangle text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">ุชูุจููุงุช ูููุฉ</p>
                        <p class="text-2xl font-bold text-gray-900" id="criticalAlerts">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Insights Cards -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Performance Summary -->
            <div class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl p-6 shadow-lg card-hover border border-blue-200">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-chart-line text-blue-600 ml-2"></i>
                    ููุฎุต ุงูุฃุฏุงุก
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">ุฃูุถู ููุฏูุจ:</span>
                        <span class="font-medium" id="topDriver">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ูุชูุณุท ููุช ุงูุชูุตูู:</span>
                        <span class="font-medium" id="avgDeliveryTime">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ุฃูุดุท ููุทูุฉ:</span>
                        <span class="font-medium" id="mostActiveArea">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช:</span>
                        <span class="font-medium text-green-600" id="totalRevenue">-</span>
                    </div>
                </div>
            </div>

            <!-- System Health -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl p-6 shadow-lg card-hover border border-green-200">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-heartbeat text-green-600 ml-2"></i>
                    ุตุญุฉ ุงููุธุงู
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">ููุงุกุฉ ุงููุธุงู:</span>
                        <span class="font-medium" id="systemEfficiency">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ุงูุทุงูุฉ ุงููุชุงุญุฉ:</span>
                        <span class="font-medium" id="availableCapacity">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ููุงุชูุฑ ูุชุฃุฎุฑุฉ:</span>
                        <span class="font-medium text-red-600" id="delayedInvoices">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ุฃููููุฉ ุนุงููุฉ:</span>
                        <span class="font-medium text-orange-600" id="highPriority">-</span>
                    </div>
                </div>
            </div>

            <!-- Work Distribution -->
            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200">
                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                    <i class="fas fa-users text-purple-600 ml-2"></i>
                    ุชูุฒูุน ุงูุนูู
                </h4>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">ููุงุฏูุจ ูุดุบูููู:</span>
                        <span class="font-medium" id="overloadedDrivers">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ุฃููููุฉ ุนุงููุฉ:</span>
                        <span class="font-medium" id="highPriority">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช:</span>
                        <span class="font-medium text-green-600" id="totalRevenue">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Recommendations -->
        <div class="bg-white rounded-xl p-6 shadow-lg card-hover mb-8" id="recommendationsSection" style="display: none;">
            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-lightbulb text-yellow-500 ml-2"></i>
                ุชูุตูุงุช ุงูุฐูุงุก ุงูุงุตุทูุงุนู
            </h3>
            <div id="recommendationsList" class="space-y-4">
                <!-- Recommendations will be loaded here -->
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Status Distribution Chart -->
            <div class="bg-white rounded-xl p-6 shadow-lg card-hover">
                <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-chart-pie text-indigo-600 ml-2"></i>
                    ุชูุฒูุน ุญุงูุงุช ุงูููุงุชูุฑ
                </h3>
                <div id="statusChart" style="height: 300px;"></div>
            </div>

            <!-- Revenue Chart -->
            <div class="bg-white rounded-xl p-6 shadow-lg card-hover">
                <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-chart-bar text-indigo-600 ml-2"></i>
                    ุงูุฅูุฑุงุฏุงุช ุญุณุจ ุงูุญุงูุฉ
                </h3>
                <div id="revenueChart" style="height: 300px;"></div>
            </div>
        </div>

        <!-- Delivery Performance Chart -->
        <div class="bg-white rounded-xl p-6 shadow-lg card-hover mb-8">
            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-clock text-indigo-600 ml-2"></i>
                ุฃุฏุงุก ุงูุชูุตูู
            </h3>
            <div id="deliveryChart" style="height: 300px;"></div>
        </div>

        <!-- Recent Invoices Table -->
        <div class="bg-white rounded-xl p-6 shadow-lg card-hover">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-list text-indigo-600 ml-2"></i>
                    ุฃุญุฏุซ ุงูููุงุชูุฑ
                </h3>
                <a href="invoices.html" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                    ุนุฑุถ ุงููู <i class="fas fa-arrow-left ml-1"></i>
                </a>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">ุฑูู ุงููุงุชูุฑุฉ</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">ุงุณู ุงูุนููู</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">ุงููุจูุบ</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">ุงูุญุงูุฉ</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">ุงูุฃููููุฉ</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">ุงูููุฏูุจ</th>
                            <th class="px-4 py-3 text-right font-semibold text-gray-700">ุงูุชุงุฑูุฎ</th>
                        </tr>
                    </thead>
                    <tbody id="recentInvoicesTable">
                        <!-- Recent invoices will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Floating AI Assistant -->
    <div class="floating-ai">
        <button id="aiAssistantBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 ai-pulse">
            <i class="fas fa-robot text-2xl"></i>
        </button>
        <div id="aiNotificationBadge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center hidden">0</div>
    </div>

    <!-- AI Assistant Modal -->
    <div id="aiModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-robot text-purple-600 ml-2"></i>
                    ุงููุณุงุนุฏ ุงูุฐูู
                </h3>
                <button id="closeAiModal" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-gray-800 mb-2">ูุง ุงูุฐู ูููููู ูุณุงุนุฏุชู ุจูุ</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                        <button class="ai-question bg-blue-100 text-blue-800 px-3 py-2 rounded-lg text-right hover:bg-blue-200 transition-colors" data-question="ุฃุธูุฑ ูู ุฃูุซุฑ ุงูููุฏูุจูู ุชุฃุฎูุฑุงู">
                            <i class="fas fa-clock ml-2"></i>ุฃูุซุฑ ุงูููุฏูุจูู ุชุฃุฎูุฑุงู
                        </button>
                        <button class="ai-question bg-green-100 text-green-800 px-3 py-2 rounded-lg text-right hover:bg-green-200 transition-colors" data-question="ููู ุนูุฏู ููุงุชูุฑ ููุฏ ุงูุชุณููู ุจูุงููุง ุฃูุชุฑ ูู 72 ุณุงุนุฉุ">
                            <i class="fas fa-exclamation-triangle ml-2"></i>ููุงุชูุฑ ูุชุฃุฎุฑุฉ ุฃูุซุฑ ูู 72 ุณุงุนุฉ
                        </button>
                        <button class="ai-question bg-purple-100 text-purple-800 px-3 py-2 rounded-lg text-right hover:bg-purple-200 transition-colors" data-question="ููู ุงูุนููู ุงููู ุทูุจุงุชู ูุชูุฑ ุงููุชุฑุฉ ุฏูุ">
                            <i class="fas fa-user ml-2"></i>ุฃูุดุท ุงูุนููุงุก
                        </button>
                        <button class="ai-question bg-orange-100 text-orange-800 px-3 py-2 rounded-lg text-right hover:bg-orange-200 transition-colors" data-question="ูู ูุงุชูุฑุฉ ุงุชุณููุช ุงูููุงุฑุฏูุ">
                            <i class="fas fa-check ml-2"></i>ููุงุชูุฑ ูุณููุฉ ุงูููู
                        </button>
                        <button class="ai-question bg-red-100 text-red-800 px-3 py-2 rounded-lg text-right hover:bg-red-200 transition-colors" data-question="ุฃุธูุฑ ูู ุญุงูุฉ ุงููุฎุฒูู">
                            <i class="fas fa-boxes ml-2"></i>ุญุงูุฉ ุงููุฎุฒูู
                        </button>
                        <button class="ai-question bg-indigo-100 text-indigo-800 px-3 py-2 rounded-lg text-right hover:bg-indigo-200 transition-colors" data-question="ุฃุนุทูู ุชูุตูุงุช ูุชุญุณูู ุงูุฃุฏุงุก">
                            <i class="fas fa-lightbulb ml-2"></i>ุชูุตูุงุช ุงูุฃุฏุงุก
                        </button>
                    </div>
                </div>
            </div>

            <div id="aiResponse" class="bg-blue-50 rounded-lg p-4 hidden">
                <h4 class="font-semibold text-blue-800 mb-2">ุงูุฑุฏ ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู:</h4>
                <div id="aiResponseContent" class="text-blue-700"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            initializeCharts();
            setupAIAssistant();
        });

        async function loadDashboardData() {
            try {
                const response = await fetch('analytics.json');
                const data = await response.json();
                
                // Update statistics
                document.getElementById('totalInvoices').textContent = data.totalInvoices || 0;
                document.getElementById('todayDeliveries').textContent = data.ai_insights?.performanceSummary?.todayDeliveries || 0;
                document.getElementById('pendingDeliveries').textContent = data.ai_insights?.performanceSummary?.pendingDeliveries || 0;
                document.getElementById('criticalAlerts').textContent = data.ai_insights?.criticalAlerts?.length || 0;
                
                // Update AI insights
                if (data.ai_insights) {
                    document.getElementById('topDriver').textContent = data.ai_insights.performanceSummary?.topPerformingDriver || '-';
                    document.getElementById('avgDeliveryTime').textContent = data.ai_insights.performanceSummary?.avgDeliveryTime ? 
                        Math.round(data.ai_insights.performanceSummary.avgDeliveryTime) + ' ุฏูููุฉ' : '-';
                    document.getElementById('mostActiveArea').textContent = data.ai_insights.performanceSummary?.mostActiveArea || '-';
                    
                    document.getElementById('systemEfficiency').textContent = data.ai_insights.systemHealth?.systemEfficiency ? 
                        Math.round(data.ai_insights.systemHealth.systemEfficiency) + '%' : '-';
                    document.getElementById('availableCapacity').textContent = data.ai_insights.systemHealth?.availableCapacity || 0;
                    document.getElementById('delayedInvoices').textContent = data.ai_insights.systemHealth?.totalDelayedInvoices || 0;
                    
                    document.getElementById('overloadedDrivers').textContent = data.ai_insights.systemHealth?.overloadedDrivers || 0;
                    document.getElementById('highPriority').textContent = data.ai_insights.systemHealth?.highPriorityPending || 0;
                    document.getElementById('totalRevenue').textContent = data.ai_insights.performanceSummary?.totalRevenue ? 
                        'ุฌ.ู ' + data.ai_insights.performanceSummary.totalRevenue.toLocaleString() : '-';
                    
                    // Load recommendations if available
                    if (data.ai_insights.recommendations && data.ai_insights.recommendations.length > 0) {
                        loadRecommendations(data.ai_insights.recommendations);
                    }
                }
                
                // Load recent invoices
                loadRecentInvoices(data.invoices || []);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function initializeCharts() {
            // Status Chart
            if (document.getElementById('statusChart')) {
                const statusChart = echarts.init(document.getElementById('statusChart'));
                const statusOption = {
                    tooltip: { trigger: 'item' },
                    series: [{
                        type: 'pie',
                        radius: '70%',
                        data: [
                            { value: 45, name: 'ูุณููุฉ', itemStyle: { color: '#10b981' } },
                            { value: 30, name: 'ููุฏ ุงูุชูุตูู', itemStyle: { color: '#f59e0b' } },
                            { value: 5, name: 'ูุฑุชุฌุนุฉ', itemStyle: { color: '#ef4444' } }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }]
                };
                statusChart.setOption(statusOption);
            }

            // Revenue Chart
            if (document.getElementById('revenueChart')) {
                const revenueChart = echarts.init(document.getElementById('revenueChart'));
                const revenueOption = {
                    tooltip: { trigger: 'axis' },
                    xAxis: {
                        type: 'category',
                        data: ['ูุณููุฉ', 'ููุฏ ุงูุชูุตูู', 'ูุฑุชุฌุนุฉ']
                    },
                    yAxis: { type: 'value' },
                    series: [{
                        data: [
                            { value: 125000, itemStyle: { color: '#10b981' } },
                            { value: 85000, itemStyle: { color: '#f59e0b' } },
                            { value: 15000, itemStyle: { color: '#ef4444' } }
                        ],
                        type: 'bar',
                        barWidth: '60%'
                    }]
                };
                revenueChart.setOption(revenueOption);
            }

            // Delivery Chart
            if (document.getElementById('deliveryChart')) {
                const deliveryChart = echarts.init(document.getElementById('deliveryChart'));
                const deliveryOption = {
                    tooltip: { trigger: 'axis' },
                    xAxis: {
                        type: 'category',
                        data: ['ุงูุณุจุช', 'ุงูุฃุญุฏ', 'ุงูุฅุซููู', 'ุงูุซูุงุซุงุก', 'ุงูุฃุฑุจุนุงุก', 'ุงูุฎููุณ', 'ุงูุฌูุนุฉ']
                    },
                    yAxis: { type: 'value' },
                    series: [{
                        data: [38, 42, 35, 45, 40, 38, 36],
                        type: 'line',
                        smooth: true,
                        itemStyle: { color: '#3b82f6' },
                        areaStyle: { color: 'rgba(59, 130, 246, 0.1)' }
                    }]
                };
                deliveryChart.setOption(deliveryOption);
            }
        }

        function loadRecentInvoices(invoices) {
            const tableBody = document.getElementById('recentInvoicesTable');
            if (!tableBody || !invoices.length) return;

            // Show only recent 5 invoices
            const recentInvoices = invoices.slice(0, 5);
            
            tableBody.innerHTML = recentInvoices.map(invoice => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3 font-medium">${invoice.id}</td>
                    <td class="px-4 py-3">${invoice.clientName}</td>
                    <td class="px-4 py-3">ุฌ.ู ${invoice.amount.toLocaleString()}</td>
                    <td class="px-4 py-3">
                        <span class="status-badge ${invoice.status === 'ูุณููุฉ' ? 'status-delivered' : invoice.status === 'ููุฏ ุงูุชูุตูู' ? 'status-pending' : 'status-returned'}">
                            ${invoice.status}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <span class="status-badge ${invoice.priority === 'ุนุงููุฉ' ? 'priority-high' : invoice.priority === 'ูุชูุณุทุฉ' ? 'priority-medium' : 'priority-low'}">
                            ${invoice.priority}
                        </span>
                    </td>
                    <td class="px-4 py-3">${invoice.driverCode}</td>
                    <td class="px-4 py-3">${invoice.date}</td>
                </tr>
            `).join('');
        }

        function loadRecommendations(recommendations) {
            const section = document.getElementById('recommendationsSection');
            const list = document.getElementById('recommendationsList');
            
            if (!section || !list) return;

            section.style.display = 'block';
            
            list.innerHTML = recommendations.map(rec => `
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i class="fas fa-lightbulb text-yellow-500 text-lg"></i>
                        </div>
                        <div class="mr-3 flex-1">
                            <h4 class="font-semibold text-gray-800">${rec.type}</h4>
                            <p class="text-gray-600 mt-1">${rec.message}</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs px-2 py-1 rounded-full ${
                                    rec.priority === 'ุนุงููุฉ' ? 'bg-red-100 text-red-800' :
                                    rec.priority === 'ูุชูุณุทุฉ' ? 'bg-yellow-100 text-yellow-800' :
                                    'bg-green-100 text-green-800'
                                }">
                                    ุฃููููุฉ ${rec.priority}
                                </span>
                            </div>
                            ${rec.actions ? `
                                <div class="mt-2">
                                    <span class="text-sm text-gray-500">ุฅุฌุฑุงุกุงุช ููุชุฑุญุฉ:</span>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        ${rec.actions.map(action => `
                                            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${action}</span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Setup AI Assistant
        function setupAIAssistant() {
            const aiBtn = document.getElementById('aiAssistantBtn');
            const modal = document.getElementById('aiModal');
            const closeBtn = document.getElementById('closeAiModal');
            const questions = document.querySelectorAll('.ai-question');

            aiBtn?.addEventListener('click', () => {
                modal.classList.remove('hidden');
            });

            closeBtn?.addEventListener('click', () => {
                modal.classList.add('hidden');
                document.getElementById('aiResponse').classList.add('hidden');
            });

            questions.forEach(question => {
                question.addEventListener('click', async () => {
                    const questionText = question.dataset.question;
                    await handleAIQuestion(questionText);
                });
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                    document.getElementById('aiResponse').classList.add('hidden');
                }
            });
        }

        async function handleAIQuestion(question) {
            const response = document.getElementById('aiResponse');
            const responseContent = document.getElementById('aiResponseContent');
            
            responseContent.innerHTML = '<div class="animate-pulse">ุฌุงุฑู ุงูุชุญููู...</div>';
            response.classList.remove('hidden');

            try {
                // This will be handled by the main app.js when it's loaded
                if (window.invoiceSystem) {
                    await window.invoiceSystem.handleAIChat(question);
                } else {
                    // Fallback response for demo
                    setTimeout(() => {
                        let answer = '';
                        switch(question) {
                            case 'ุฃุธูุฑ ูู ุฃูุซุฑ ุงูููุฏูุจูู ุชุฃุฎูุฑุงู':
                                answer = 'ุฃูุซุฑ ุงูููุฏูุจูู ุชุฃุฎูุฑุงู:<br>โข ูุญููุฏ ุนูู: 3 ููุงุชูุฑ ููุฏ ุงูุชูุตูู<br>โข ุฎุงูุฏ ุญุณู: 2 ูุงุชูุฑุฉ ููุฏ ุงูุชูุตูู';
                                break;
                            case 'ููู ุนูุฏู ููุงุชูุฑ ููุฏ ุงูุชุณููู ุจูุงููุง ุฃูุชุฑ ูู 72 ุณุงุนุฉุ':
                                answer = 'ูุง ุชูุฌุฏ ููุงุชูุฑ ูุชุฃุฎุฑุฉ ุฃูุซุฑ ูู 72 ุณุงุนุฉ ุญุงููุงู.';
                                break;
                            case 'ููู ุงูุนููู ุงููู ุทูุจุงุชู ูุชูุฑ ุงููุชุฑุฉ ุฏูุ':
                                answer = 'ุฃูุดุท ุงูุนููุงุก:<br>โข ุฃุญูุฏ ูุญูุฏ: 5 ููุงุชูุฑ<br>โข ุณุงุฑุฉ ุฃุญูุฏ: 3 ููุงุชูุฑ';
                                break;
                            case 'ูู ูุงุชูุฑุฉ ุงุชุณููุช ุงูููุงุฑุฏูุ':
                                answer = 'ุนุฏุฏ ุงูููุงุชูุฑ ุงููุณููุฉ ุงูููู: 12 ูุงุชูุฑุฉ';
                                break;
                            default:
                                answer = 'ุณุฃููู ุจุชุญููู ุทูุจู ุจุงุณุชุฎุฏุงู DeepSeek...';
                        }
                        responseContent.innerHTML = answer;
                    }, 1500);
                }
            } catch (error) {
                console.error('Error handling AI question:', error);
                responseContent.innerHTML = 'ุญุฏุซ ุฎุทุฃ ูู ูุนุงูุฌุฉ ุงูุณุคุงู.';
            }
        }
    </script>
</body>
</html>