<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ - Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .status-available { @apply bg-green-100 text-green-800; }
        .status-busy { @apply bg-red-100 text-red-800; }
        .status-offline { @apply bg-gray-100 text-gray-800; }
        .floating-ai { position: fixed; bottom: 30px; left: 30px; z-index: 1000; }
        .ai-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .rating-stars { color: #fbbf24; }
        .efficiency-bar { background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-gray-900">ğŸ“Š Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø°ÙƒÙŠ</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-tachometer-alt ml-2"></i>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    </a>
                    <a href="invoices.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-file-invoice ml-2"></i>Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                    </a>
                    <a href="drivers.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-truck ml-2"></i>Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨
                    </a>
                    <a href="alerts.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-bell ml-2"></i>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                    </a>
                    <a href="new-orders.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-plus-circle ml-2"></i>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    </a>
                    <a href="inventory.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-boxes ml-2"></i>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                    </a>
                    <a href="archive.html" class="text-gray-600 hover:text-gray-900 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i class="fas fa-archive ml-2"></i>Ø§Ù„Ø£Ø±Ø´ÙŠÙ
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header Section -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h2 class="text-3xl font-bold text-gray-900">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</h2>
                <p class="text-gray-600 mt-2">Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„</p>
            </div>
            <div class="flex space-x-3">
                <button id="addDriverBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                    <i class="fas fa-user-plus ml-2"></i>Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨
                </button>
                <button id="workDistributionBtn" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors flex items-center">
                    <i class="fas fa-users-cog ml-2"></i>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø°ÙƒÙŠ
                </button>
                <button id="performanceAnalysisBtn" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center">
                    <i class="fas fa-chart-line ml-2"></i>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡
                </button>
            </div>
        </div>

        <!-- Statistics Overview -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-blue-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="fas fa-users text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalDrivers">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-green-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                        <i class="fas fa-user-check text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">Ù…ØªØ§Ø­</p>
                        <p class="text-2xl font-bold text-gray-900" id="availableDrivers">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-red-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-red-100 text-red-600">
                        <i class="fas fa-user-clock text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">Ù…Ø´ØºÙˆÙ„</p>
                        <p class="text-2xl font-bold text-gray-900" id="busyDrivers">0</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl p-6 shadow-lg card-hover border-l-4 border-orange-500">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-orange-100 text-orange-600">
                        <i class="fas fa-chart-line text-2xl"></i>
                    </div>
                    <div class="mr-4">
                        <p class="text-sm font-medium text-gray-600">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙƒÙØ§Ø¡Ø©</p>
                        <p class="text-2xl font-bold text-gray-900" id="avgEfficiency">0%</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="bg-white rounded-xl p-6 shadow-lg card-hover mb-8">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-chart-bar text-blue-600 ml-2"></i>
                Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨
            </h3>
            <div id="performanceChart" style="height: 400px;"></div>
        </div>

        <!-- Drivers Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" id="driversGrid">
            <!-- Driver cards will be loaded here -->
        </div>

        <!-- Work Distribution Section -->
        <div class="bg-white rounded-xl p-6 shadow-lg card-hover mb-8" id="workDistributionSection" style="display: none;">
            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-users-cog text-purple-600 ml-2"></i>
                ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø°ÙƒÙŠ
            </h3>
            <div id="workDistributionContent" class="space-y-4">
                <!-- Work distribution suggestions will be loaded here -->
            </div>
        </div>

        <!-- Performance Analysis Section -->
        <div class="bg-white rounded-xl p-6 shadow-lg card-hover" id="performanceAnalysisSection" style="display: none;">
            <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                <i class="fas fa-chart-line text-green-600 ml-2"></i>
                ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ
            </h3>
            <div id="performanceAnalysisContent" class="space-y-6">
                <!-- Performance analysis will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Floating AI Assistant -->
    <div class="floating-ai">
        <button id="aiAssistantBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white p-4 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110 ai-pulse">
            <i class="fas fa-robot text-2xl"></i>
        </button>
    </div>

    <!-- Add Driver Modal -->
    <div id="addDriverModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-user-plus text-green-600 ml-2"></i>
                    Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨ Ø¬Ø¯ÙŠØ¯
                </h3>
                <button id="closeAddDriverModal" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addDriverForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                        <input type="text" id="driverName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                        <input type="tel" id="driverPhone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø© *</label>
                        <input type="text" id="driverVehicle" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØºØ·Ø§Ø©</label>
                        <select id="driverAreas" multiple class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                            <option value="Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
                            <option value="Ø§Ù„Ø¬ÙŠØ²Ø©">Ø§Ù„Ø¬ÙŠØ²Ø©</option>
                            <option value="Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                            <option value="Ù…Ø¯ÙŠÙ†Ø© Ù†ØµØ±">Ù…Ø¯ÙŠÙ†Ø© Ù†ØµØ±</option>
                            <option value="Ø§Ù„Ù…Ø¹Ø§Ø¯ÙŠ">Ø§Ù„Ù…Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="Ø§Ù„Ø¯Ù‚ÙŠ">Ø§Ù„Ø¯Ù‚ÙŠ</option>
                            <option value="Ø§Ù„Ù‡Ø±Ù…">Ø§Ù„Ù‡Ø±Ù…</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <textarea id="driverNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"></textarea>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancelAddDriver" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-save ml-2"></i>Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Driver Details Modal -->
    <div id="driverModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-user text-blue-600 ml-2"></i>
                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
                </h3>
                <button id="closeDriverModal" class="text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="driverModalContent" class="space-y-6">
                <!-- Driver details will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let driversData = [];
        let performanceData = {};

        document.addEventListener('DOMContentLoaded', function() {
            loadDriversData();
            setupEventListeners();
            setupAIAssistant();
        });

        async function loadDriversData() {
            try {
                const [driversResponse, analyticsResponse] = await Promise.all([
                    fetch('drivers.json'),
                    fetch('analytics.json')
                ]);
                
                driversData = await driversResponse.json();
                const analyticsData = await analyticsResponse.json();
                performanceData = analyticsData.driverPerformance || {};
                
                updateStatistics();
                renderDriversGrid();
                initializePerformanceChart();
                
            } catch (error) {
                console.error('Error loading drivers data:', error);
            }
        }

        function updateStatistics() {
            const total = driversData.length;
            const available = driversData.filter(d => d.status === 'Ù…ØªØ§Ø­').length;
            const busy = driversData.filter(d => d.status === 'Ù…Ø´ØºÙˆÙ„').length;
            const avgEfficiency = driversData.reduce((sum, d) => sum + d.efficiency, 0) / total * 100;

            document.getElementById('totalDrivers').textContent = total;
            document.getElementById('availableDrivers').textContent = available;
            document.getElementById('busyDrivers').textContent = busy;
            document.getElementById('avgEfficiency').textContent = Math.round(avgEfficiency) + '%';
        }

        function renderDriversGrid() {
            const grid = document.getElementById('driversGrid');
            
            grid.innerHTML = driversData.map(driver => {
                const performance = performanceData[driver.code] || {};
                const ratingStars = 'â˜…'.repeat(Math.floor(driver.rating)) + 'â˜†'.repeat(5 - Math.floor(driver.rating));
                
                return `
                    <div class="bg-white rounded-xl p-6 shadow-lg card-hover border border-gray-200">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg">
                                    ${driver.name.split(' ').map(n => n[0]).join('')}
                                </div>
                                <div class="mr-4">
                                    <h3 class="text-lg font-semibold text-gray-900">${driver.name}</h3>
                                    <p class="text-sm text-gray-600">${driver.code}</p>
                                </div>
                            </div>
                            <span class="status-${driver.status === 'Ù…ØªØ§Ø­' ? 'available' : driver.status === 'Ù…Ø´ØºÙˆÙ„' ? 'busy' : 'offline'} px-3 py-1 rounded-full text-xs font-medium">
                                ${driver.status}
                            </span>
                        </div>
                        
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</span>
                                <span class="font-medium">${driver.vehicleNumber}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø§Ù„Ø­Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                                <span class="font-medium">${driver.currentLoad} ÙØ§ØªÙˆØ±Ø©</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª:</span>
                                <span class="font-medium">${driver.totalDeliveries}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                                <span class="rating-stars font-medium">${ratingStars} ${driver.rating}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ø§Ù„ÙƒÙØ§Ø¡Ø©:</span>
                                <span class="font-medium">${Math.round(driver.efficiency * 100)}%</span>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600">Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span>
                                <span class="text-gray-600">${performance.deliveredCount || 0}/${performance.totalInvoices || 0}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="efficiency-bar h-2 rounded-full" style="width: ${performance.successRate || 0}%"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: ${performance.successRate || 0}%</div>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="flex space-x-2">
                                <button onclick="showDriverDetails('${driver.code}')" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                    <i class="fas fa-eye ml-1"></i>Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                </button>
                                <button onclick="assignWork('${driver.code}')" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                    <i class="fas fa-tasks ml-1"></i>ØªÙˆØ²ÙŠØ¹ Ù…Ù‡Ø§Ù…
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function initializePerformanceChart() {
            const chart = echarts.init(document.getElementById('performanceChart'));
            
            const driverNames = driversData.map(d => d.name);
            const deliveredData = driverNames.map(name => {
                const driver = driversData.find(d => d.name === name);
                const performance = performanceData[driver.code] || {};
                return performance.deliveredCount || 0;
            });
            const pendingData = driverNames.map(name => {
                const driver = driversData.find(d => d.name === name);
                const performance = performanceData[driver.code] || {};
                return performance.pendingCount || 0;
            });
            const returnedData = driverNames.map(name => {
                const driver = driversData.find(d => d.name === name);
                const performance = performanceData[driver.code] || {};
                return performance.returnedCount || 0;
            });

            const option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'shadow' }
                },
                legend: {
                    data: ['Ù…Ø³Ù„Ù…Ø©', 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„', 'Ù…Ø±ØªØ¬Ø¹Ø©']
                },
                xAxis: {
                    type: 'category',
                    data: driverNames
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: 'Ù…Ø³Ù„Ù…Ø©',
                        type: 'bar',
                        stack: 'total',
                        data: deliveredData,
                        itemStyle: { color: '#10b981' }
                    },
                    {
                        name: 'Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„',
                        type: 'bar',
                        stack: 'total',
                        data: pendingData,
                        itemStyle: { color: '#f59e0b' }
                    },
                    {
                        name: 'Ù…Ø±ØªØ¬Ø¹Ø©',
                        type: 'bar',
                        stack: 'total',
                        data: returnedData,
                        itemStyle: { color: '#ef4444' }
                    }
                ]
            };

            chart.setOption(option);
            
            // Make chart responsive
            window.addEventListener('resize', function() {
                chart.resize();
            });
        }

        function setupEventListeners() {
            // Work Distribution Button
            document.getElementById('workDistributionBtn').addEventListener('click', showWorkDistribution);
            
            // Performance Analysis Button
            document.getElementById('performanceAnalysisBtn').addEventListener('click', showPerformanceAnalysis);
            
            // Add Driver Modal
            document.getElementById('addDriverBtn').addEventListener('click', () => {
                document.getElementById('addDriverModal').classList.remove('hidden');
            });
            
            document.getElementById('closeAddDriverModal').addEventListener('click', () => {
                document.getElementById('addDriverModal').classList.add('hidden');
            });
            
            document.getElementById('cancelAddDriver').addEventListener('click', () => {
                document.getElementById('addDriverModal').classList.add('hidden');
            });
            
            // Add Driver Form
            document.getElementById('addDriverForm').addEventListener('submit', addNewDriver);
            
            // Driver Modal
            document.getElementById('closeDriverModal').addEventListener('click', () => {
                document.getElementById('driverModal').classList.add('hidden');
            });
        }

        async function showWorkDistribution() {
            const section = document.getElementById('workDistributionSection');
            const content = document.getElementById('workDistributionContent');
            
            section.style.display = 'block';
            content.innerHTML = '<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"></div><p class="mt-2 text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>';

            try {
                const response = await fetch('ai_insights.json');
                const data = await response.json();
                
                if (data.workDistribution && data.workDistribution.length > 0) {
                    content.innerHTML = data.workDistribution.map(suggestion => `
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-2 flex items-center">
                                <i class="fas fa-user text-purple-600 ml-2"></i>
                                ${suggestion.driverName} - Ø³Ø¹Ø© Ù…ØªØ§Ø­Ø©: ${suggestion.capacity} ÙÙˆØ§ØªÙŠØ±
                            </h4>
                            <div class="space-y-2">
                                ${suggestion.suggestedTransfers.map(transfer => `
                                    <div class="bg-white rounded-lg p-3 border border-purple-100">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="text-sm font-medium text-purple-800">
                                                    Ù†Ù‚Ù„ ${transfer.invoiceCount} ÙØ§ØªÙˆØ±Ø© Ù…Ù† ${transfer.fromDriver}
                                                </p>
                                                <p class="text-xs text-purple-600">Ø§Ù„Ø³Ø¨Ø¨: ${transfer.reason}</p>
                                            </div>
                                            <span class="priority-${transfer.priority === 'Ø¹Ø§Ù„ÙŠØ©' ? 'high' : 'medium'} px-2 py-1 rounded text-xs">
                                                ${transfer.priority} Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©
                                            </span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-3 flex flex-wrap gap-1">
                                <span class="text-xs text-purple-600">Ø§Ù„Ù…Ù†Ø§Ø·Ù‚: ${suggestion.areas.join(', ')}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<div class="text-center py-8 text-gray-500"><i class="fas fa-info-circle text-4xl mb-4"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹</p></div>';
                }
                
            } catch (error) {
                console.error('Error loading work distribution:', error);
                content.innerHTML = '<div class="text-center py-8 text-red-500"><i class="fas fa-exclamation-triangle text-4xl mb-4"></i><p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p></div>';
            }
        }

        async function showPerformanceAnalysis() {
            const section = document.getElementById('performanceAnalysisSection');
            const content = document.getElementById('performanceAnalysisContent');
            
            section.style.display = 'block';
            content.innerHTML = '<div class="text-center py-8"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"></div><p class="mt-2 text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>';

            try {
                const response = await fetch('analytics.json');
                const data = await response.json();
                
                let analysisHTML = '';
                
                // Driver Performance Comparison
                if (data.driverPerformance) {
                    const drivers = Object.values(data.driverPerformance);
                    analysisHTML += `
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200">
                            <h4 class="text-lg font-semibold text-blue-800 mb-4 flex items-center">
                                <i class="fas fa-trophy text-blue-600 ml-2"></i>
                                Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                ${drivers.map(driver => `
                                    <div class="bg-white rounded-lg p-4 border border-blue-100">
                                        <h5 class="font-semibold text-blue-800 mb-3">${driver.name}</h5>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±:</span>
                                                <span class="font-medium">${driver.totalInvoices}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Ù…Ø³Ù„Ù…Ø©:</span>
                                                <span class="font-medium text-green-600">${driver.deliveredCount}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                                                <span class="font-medium text-yellow-600">${driver.pendingCount}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Ù…Ø±ØªØ¬Ø¹Ø©:</span>
                                                <span class="font-medium text-red-600">${driver.returnedCount}</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:</span>
                                                <span class="font-medium">${driver.successRate}%</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª:</span>
                                                <span class="font-medium">${driver.avgDeliveryTime} Ø¯Ù‚ÙŠÙ‚Ø©</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Efficiency Analysis
                if (data.driverPerformance) {
                    const drivers = Object.values(data.driverPerformance);
                    const avgEfficiency = drivers.reduce((sum, d) => sum + d.efficiency, 0) / drivers.length;
                    const topPerformer = drivers.reduce((max, d) => d.efficiency > max.efficiency ? d : max);
                    const needsImprovement = drivers.filter(d => d.efficiency < avgEfficiency);
                    
                    analysisHTML += `
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-6 border border-green-200">
                            <h4 class="text-lg font-semibold text-green-800 mb-4 flex items-center">
                                <i class="fas fa-chart-pie text-green-600 ml-2"></i>
                                ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙØ§Ø¡Ø©
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-white rounded-lg p-4 border border-green-100">
                                    <h5 class="font-semibold text-green-800 mb-2">Ø£ÙØ¶Ù„ Ø£Ø¯Ø§Ø¡</h5>
                                    <p class="text-sm text-gray-600">${topPerformer.name} Ø¨ÙƒÙØ§Ø¡Ø© ${Math.round(topPerformer.efficiency * 100)}%</p>
                                    <div class="mt-2 text-xs text-gray-500">
                                        Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: ${topPerformer.successRate}% | Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª: ${topPerformer.avgDeliveryTime} Ø¯Ù‚ÙŠÙ‚Ø©
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-green-100">
                                    <h5 class="font-semibold text-green-800 mb-2">ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†</h5>
                                    ${needsImprovement.length > 0 ? 
                                        needsImprovement.map(d => `<p class="text-sm text-gray-600">${d.name}: ${Math.round(d.efficiency * 100)}%</p>`).join('') :
                                        '<p class="text-sm text-gray-600">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ ÙÙˆÙ‚ Ø§Ù„Ù…ØªÙˆØ³Ø·</p>'
                                    }
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (analysisHTML === '') {
                    analysisHTML = '<div class="text-center py-8 text-gray-500"><i class="fas fa-info-circle text-4xl mb-4"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù„ØªØ­Ù„ÙŠÙ„</p></div>';
                }
                
                content.innerHTML = analysisHTML;
                
            } catch (error) {
                console.error('Error loading performance analysis:', error);
                content.innerHTML = '<div class="text-center py-8 text-red-500"><i class="fas fa-exclamation-triangle text-4xl mb-4"></i><p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„</p></div>';
            }
        }

        function showDriverDetails(driverCode) {
            const driver = driversData.find(d => d.code === driverCode);
            const performance = performanceData[driverCode] || {};
            const modal = document.getElementById('driverModal');
            const content = document.getElementById('driverModalContent');
            
            const ratingStars = 'â˜…'.repeat(Math.floor(driver.rating)) + 'â˜†'.repeat(5 - Math.floor(driver.rating));
            
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200">
                            <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                                <i class="fas fa-user text-blue-600 ml-2"></i>
                                Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø§Ù„Ø§Ø³Ù…:</span>
                                    <span class="font-medium">${driver.name}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø§Ù„ÙƒÙˆØ¯:</span>
                                    <span class="font-medium">${driver.code}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                                    <span class="font-medium">${driver.phone}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø±Ù‚Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø©:</span>
                                    <span class="font-medium">${driver.vehicleNumber}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                                    <span class="status-${driver.status === 'Ù…ØªØ§Ø­' ? 'available' : driver.status === 'Ù…Ø´ØºÙˆÙ„' ? 'busy' : 'offline'} px-2 py-1 rounded text-xs">
                                        ${driver.status}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200">
                            <h4 class="font-semibold text-purple-800 mb-3 flex items-center">
                                <i class="fas fa-star text-purple-600 ml-2"></i>
                                Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„ÙƒÙØ§Ø¡Ø©
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                                    <span class="rating-stars font-medium">${ratingStars} ${driver.rating}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø§Ù„ÙƒÙØ§Ø¡Ø©:</span>
                                    <span class="font-medium">${Math.round(driver.efficiency * 100)}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:</span>
                                    <span class="font-medium">${driver.joinDate}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border border-green-200">
                            <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                                <i class="fas fa-chart-bar text-green-600 ml-2"></i>
                                Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±:</span>
                                    <span class="font-medium">${performance.totalInvoices || 0}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ù…Ø³Ù„Ù…Ø©:</span>
                                    <span class="font-medium text-green-600">${performance.deliveredCount || 0}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ù‚ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                                    <span class="font-medium text-yellow-600">${performance.pendingCount || 0}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ù…Ø±ØªØ¬Ø¹Ø©:</span>
                                    <span class="font-medium text-red-600">${performance.returnedCount || 0}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:</span>
                                    <span class="font-medium">${performance.successRate || 0}%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Ù…ØªÙˆØ³Ø· Ø§Ù„ÙˆÙ‚Øª:</span>
                                    <span class="font-medium">${performance.avgDeliveryTime || 0} Ø¯Ù‚ÙŠÙ‚Ø©</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border border-orange-200">
                            <h4 class="font-semibold text-orange-800 mb-3 flex items-center">
                                <i class="fas fa-map-marker-alt text-orange-600 ml-2"></i>
                                Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØºØ·Ø§Ø©
                            </h4>
                            <div class="flex flex-wrap gap-2">
                                ${driver.areas.map(area => `
                                    <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">
                                        ${area}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function assignWork(driverCode) {
            alert('Ø³ÙŠØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù… Ù„Ù„Ù…Ù†Ø¯ÙˆØ¨ ' + driverCode + ' ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©');
        }

        function setupAIAssistant() {
            const aiBtn = document.getElementById('aiAssistantBtn');
            
            aiBtn.addEventListener('click', () => {
                // Redirect to main AI assistant in index.html
                window.location.href = 'index.html#aiAssistant';
            });
        }
    </script>
</body>
</html>